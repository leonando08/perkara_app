<!DOCTYPE html>
<html>
<head>
    <title>Test Cooldown Bug Fix</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .button { padding: 10px; margin: 5px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; }
        .debug { background: #f8f9fa; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h2>Test Cooldown Bug Fix</h2>
    
    <div class="section">
        <h3>Problem:</h3>
        <p>Setelah cooldown 5 menit selesai, user langsung kena cooldown lagi padahal belum ngapa-ngapain.</p>
        
        <h3>Root Cause:</h3>
        <p>Attempts counter tidak direset setelah cooldown selesai, jadi meskipun cooldown habis, attempts masih >= 5.</p>
        
        <h3>Solution:</h3>
        <ol>
            <li>Reset attempts counter saat cooldown selesai</li>
            <li>Check dan reset expired cooldown saat halaman dimuat</li>
            <li>Enhanced debug untuk monitoring</li>
        </ol>
    </div>

    <div class="section">
        <h3>Testing Tools:</h3>
        <a href="http://localhost:8080/index.php/auth/debug_session" class="button" target="_blank">Debug Session</a>
        <a href="http://localhost:8080/index.php/auth/clear_cooldown" class="button" target="_blank">Clear Cooldown</a>
        <a href="http://localhost:8080/index.php/auth/login" class="button" target="_blank">Login Page</a>
        
        <div class="debug">
            <h4>Debug Info Meaning:</h4>
            <ul>
                <li><strong>captcha_attempts:</strong> Berapa kali user salah captcha</li>
                <li><strong>captcha_cooldown:</strong> Timestamp saat cooldown dimulai</li>
                <li><strong>cooldown_remaining:</strong> Sisa detik cooldown</li>
                <li><strong>cooldown_expired:</strong> Apakah cooldown sudah selesai</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h3>Test Scenario:</h3>
        <ol>
            <li>Salah captcha 5x → Cooldown aktif</li>
            <li>Tunggu 5 menit (atau clear manual)</li>
            <li>Reload halaman login → Seharusnya normal (tidak langsung cooldown)</li>
            <li>Coba login normal → Seharusnya bisa input captcha</li>
        </ol>
    </div>

    <script>
        setInterval(() => {
            document.getElementById('timestamp').textContent = new Date().toLocaleTimeString();
        }, 1000);
    </script>
    
    <p>Current time: <span id="timestamp"></span></p>
</body>
</html>